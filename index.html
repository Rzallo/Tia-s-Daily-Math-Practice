<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tia's Daily Math Practice</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-mode {
            background-color: #121212;
            color: #f4f4f4;
        }
        .container {
            max-width: 700px;
            margin: 2em auto;
            padding: 2em;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .dark-mode .container {
            background-color: #1e1e1e;
        }
        h1 {
            text-align: center;
            margin-bottom: 1em;
            font-size: 2em;
        }
        button, select {
            padding: 0.6em 1.2em;
            margin: 0.5em;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        button:hover, select:hover {
            background-color: #0056b3;
        }
        .stats, .question, .answers, .feedback, .joke, .tip, .timer {
            margin: 1em 0;
            text-align: center;
        }
        .answers button {
            display: block;
            width: 90%;
            max-width: 400px;
            margin: 0.5em auto;
            font-size: 1em;
        }
        .header-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1em;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tia's Daily Math Practice</h1>
        <div class="header-row">
            <label for="difficulty">Select Difficulty:</label>
            <select id="difficulty">
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
                <option value="hardest">Hardest</option>
            </select>
            <button onclick="setDifficulty()">Change Difficulty</button>
            <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
        </div>
        <div class="stats">
            <p id="streak">Daily Streak: 0</p>
            <p id="accuracy">Accuracy: 0%</p>
            <p id="total">Total Answered: 0</p>
            <p id="timer">Time on question: 0s</p>
            <p id="avgTime">Average Time: 0s</p>
        </div>
        <div class="question" id="question">Loading...</div>
        <div class="answers" id="answers"></div>
        <div class="feedback" id="feedback"></div>
        <div class="joke" id="joke"></div>
        <div class="tip" id="tip"></div>
        <div style="text-align:center">
            <button onclick="generateQuestion()">Next Question</button>
        </div>
    </div>
    <script>
        let currentStreak = localStorage.getItem('streak') || 0;
        let totalCorrect = Number(localStorage.getItem('correct') || 0);
        let totalAnswered = Number(localStorage.getItem('answered') || 0);
        let totalTime = Number(localStorage.getItem('totalTime') || 0);
        let difficulty = localStorage.getItem('difficulty') || 'easy';

        let timerInterval;
        let currentTime = 0;

        const jokes = [
            "Why was the math book sad? It had too many problems.",
            "Parallel lines have so much in common. It’s a shame they’ll never meet.",
            "Why don’t calculators make good friends? Because they can be calculating!",
            "What’s the best tool to do math? Multi-pliers!",
            "Without geometry, life is pointless."
        ];

        const tips = [
            "Convert all numbers to the same notation before multiplying or dividing.",
            "When multiplying numbers in scientific notation, multiply the base numbers and add the exponents.",
            "When dividing, divide the base numbers and subtract the exponents.",
            "Remember: a negative exponent means you’re dealing with a small number.",
            "You can move the decimal to convert between standard and scientific notation quickly."
        ];

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        function setDifficulty() {
            difficulty = document.getElementById('difficulty').value;
            localStorage.setItem('difficulty', difficulty);
            generateQuestion();
        }

        function updateStats() {
            document.getElementById('streak').innerText = `Daily Streak: ${currentStreak}`;
            const accuracy = totalAnswered > 0 ? ((totalCorrect / totalAnswered) * 100).toFixed(1) : 0;
            document.getElementById('accuracy').innerText = `Accuracy: ${accuracy}%`;
            document.getElementById('total').innerText = `Total Answered: ${totalAnswered}`;
            const avgTime = totalAnswered > 0 ? (totalTime / totalAnswered).toFixed(1) : 0;
            document.getElementById('avgTime').innerText = `Average Time: ${avgTime}s`;
        }

        function startTimer() {
            clearInterval(timerInterval);
            currentTime = 0;
            document.getElementById('timer').innerText = `Time on question: 0s`;
            timerInterval = setInterval(() => {
                currentTime++;
                document.getElementById('timer').innerText = `Time on question: ${currentTime}s`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            totalTime += currentTime;
            localStorage.setItem('totalTime', totalTime);
        }

        function randomNumber(range) {
            return Math.random() * range;
        }

        function toScientific(n) {
            return n.toExponential(2).replace('e', 'x10^');
        }

        function getRandomQuestion() {
            let range;
            switch(difficulty) {
                case 'easy': range = 1; break;
                case 'medium': range = 100; break;
                case 'hard': range = 1000; break;
                case 'hardest': range = 10000; break;
                default: range = 1;
            }

            const isScientific = Math.random() < 0.5;
            const isDivision = Math.random() < 0.5;
            let a = isScientific ? toScientific(randomNumber(range)) : (randomNumber(range)).toFixed(4);
            let b = isScientific ? toScientific(randomNumber(range)) : (randomNumber(range)).toFixed(4);
            let answer = isDivision ? eval(a.replace('x10^', 'e')) / eval(b.replace('x10^', 'e')) : eval(a.replace('x10^', 'e')) * eval(b.replace('x10^', 'e'));
            answer = Number(answer.toPrecision(3));

            const questionText = `${a} ${isDivision ? '/' : '*'} ${b} = ?`;
            return { questionText, correctAnswer: answer };
        }

        let attempt = 0;
        let currentCorrectAnswer = null;

        function generateQuestion() {
            stopTimer();
            startTimer();
            attempt = 0;
            const { questionText, correctAnswer } = getRandomQuestion();
            currentCorrectAnswer = correctAnswer;
            document.getElementById('question').innerText = questionText;
            document.getElementById('feedback').innerText = '';
            document.getElementById('joke').innerText = '';
            document.getElementById('tip').innerText = '';

            const answersDiv = document.getElementById('answers');
            answersDiv.innerHTML = '';
            const choices = [correctAnswer];
            while (choices.length < 4) {
                let delta = Math.max(0.1, Math.abs(correctAnswer) * (Math.random() * 0.5 + 0.5));
                let wrongAnswer = Math.random() < 0.5 ? correctAnswer + delta : correctAnswer - delta;
                wrongAnswer = Number(wrongAnswer.toPrecision(3));
                if (!choices.includes(wrongAnswer)) choices.push(wrongAnswer);
            }
            choices.sort(() => Math.random() - 0.5);

            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.innerText = choice;
                btn.onclick = () => checkAnswer(choice);
                answersDiv.appendChild(btn);
            });
        }

        function checkAnswer(selected) {
            if (attempt >= 2) return;
            attempt++;
            if (selected === currentCorrectAnswer) {
                stopTimer();
                totalCorrect++;
                currentStreak++;
                totalAnswered++;
                document.getElementById('feedback').innerText = '✅ Correct!';
                document.getElementById('joke').innerText = `Joke: ${jokes[Math.floor(Math.random() * jokes.length)]}`;
                document.getElementById('tip').innerText = `Tip: ${tips[Math.floor(Math.random() * tips.length)]}`;
                disableButtons();
            } else {
                if (attempt >= 2) {
                    stopTimer();
                    totalAnswered++;
                    currentStreak = 0;
                    document.getElementById('feedback').innerText = `❌ Incorrect. Correct answer was: ${currentCorrectAnswer}`;
                    disableButtons();
                } else {
                    document.getElementById('feedback').innerText = `❌ Try again.`;
                }
            }
            localStorage.setItem('streak', currentStreak);
            localStorage.setItem('correct', totalCorrect);
            localStorage.setItem('answered', totalAnswered);
            updateStats();
        }

        function disableButtons() {
            const btns = document.querySelectorAll('#answers button');
            btns.forEach(b => b.disabled = true);
        }

        // Initialize
        document.getElementById('difficulty').value = difficulty;
        updateStats();
        generateQuestion();
    </script>
</body>
</html>
