<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tia's Daily Math Practice</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #f4f4f4;
    }

    .container {
      max-width: 720px;
      margin: 2em auto;
      padding: 2em;
      background-color: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }

    h1 {
      text-align: center;
      font-size: 2.4em;
      margin-bottom: 0.5em;
      color: #74b9ff;
    }

    .header-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 1em;
      margin-bottom: 1em;
    }

    .stats p, .timer p {
      margin: 0.3em 0;
      text-align: center;
      font-size: 1em;
    }

    select, button {
      padding: 0.6em 1em;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      background-color: #3498db;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button:hover, select:hover {
      background-color: #2980b9;
    }

    .question {
      font-size: 1.5em;
      text-align: center;
      margin: 1em 0;
    }

    .answers button {
      display: block;
      margin: 0.5em auto;
      width: 90%;
      max-width: 400px;
      padding: 0.75em;
      font-size: 1.1em;
      background-color: #2c3e50;
      border: 2px solid #2980b9;
    }

    .answers button:hover:not(:disabled) {
      background-color: #34495e;
    }

    .feedback, .joke, .tip {
      text-align: center;
      margin: 1em 0 0.5em;
      font-size: 1em;
    }

    .next-container {
      text-align: center;
      margin-top: 1.5em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìò Daily Math Practice</h1>

    <div class="header-row">
      <label for="difficulty">Select Difficulty:</label>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
        <option value="hardest">Hardest</option>
      </select>
      <button onclick="setDifficulty()">Change Difficulty</button>
    </div>

    <div class="stats">
      <p id="streak">üî• Current Streak: 0 days</p>
      <p id="accuracy">‚úÖ Overall Accuracy: 0%</p>
      <p id="total">üìä Total Answered: 0</p>
      <p id="timer">‚è±Ô∏è Time on question: 0s</p>
      <p id="avgTime">üìà Average Time: 0s</p>
    </div>

    <div class="question" id="question">Loading...</div>
    <div class="answers" id="answers"></div>
    <div class="feedback" id="feedback"></div>
    <div class="joke" id="joke"></div>
    <div class="tip" id="tip"></div>

    <div class="next-container">
      <button onclick="generateQuestion()">Next Question</button>
    </div>
  </div>

  <script>
    let currentStreak = localStorage.getItem('streak') || 0;
    let totalCorrect = Number(localStorage.getItem('correct') || 0);
    let totalAnswered = Number(localStorage.getItem('answered') || 0);
    let totalTime = Number(localStorage.getItem('totalTime') || 0);
    let difficulty = localStorage.getItem('difficulty') || 'easy';

    let timerInterval;
    let currentTime = 0;

    const jokes = [
      "Why was the math book sad? It had too many problems.",
      "Parallel lines have so much in common. It‚Äôs a shame they‚Äôll never meet.",
      "Why don‚Äôt calculators make good friends? Because they can be calculating!",
      "What‚Äôs the best tool to do math? Multi-pliers!",
      "Without geometry, life is pointless."
    ];

    const tips = [
      "Convert all numbers to the same notation before multiplying or dividing.",
      "When multiplying in scientific notation, multiply the bases and add exponents.",
      "When dividing, divide bases and subtract exponents.",
      "A negative exponent means a very small number.",
      "Move the decimal to convert between standard and scientific notation."
    ];

    function setDifficulty() {
      difficulty = document.getElementById('difficulty').value;
      localStorage.setItem('difficulty', difficulty);
      generateQuestion();
    }

    function updateStats() {
      document.getElementById('streak').innerText = `üî• Current Streak: ${currentStreak} days`;
      const accuracy = totalAnswered > 0 ? ((totalCorrect / totalAnswered) * 100).toFixed(1) : 0;
      document.getElementById('accuracy').innerText = `‚úÖ Overall Accuracy: ${accuracy}%`;
      document.getElementById('total').innerText = `üìä Total Answered: ${totalAnswered}`;
      const avgTime = totalAnswered > 0 ? (totalTime / totalAnswered).toFixed(1) : 0;
      document.getElementById('avgTime').innerText = `üìà Average Time: ${avgTime}s`;
    }

    function startTimer() {
      clearInterval(timerInterval);
      currentTime = 0;
      document.getElementById('timer').innerText = `‚è±Ô∏è Time on question: 0s`;
      timerInterval = setInterval(() => {
        currentTime++;
        document.getElementById('timer').innerText = `‚è±Ô∏è Time on question: ${currentTime}s`;
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      totalTime += currentTime;
      localStorage.setItem('totalTime', totalTime);
    }

    function randomNumber(range) {
      return Math.random() * range + 1;
    }

    function getRandomQuestion() {
      let range = { easy: 10, medium: 100, hard: 1000, hardest: 10000 }[difficulty];
      const isScientific = Math.random() < 0.5;
      const isDivision = Math.random() < 0.5;
      let aRaw = randomNumber(range);
      let bRaw = randomNumber(range);
      if (isDivision && Math.abs(bRaw) < 0.01) bRaw += 1;
      let answer = isDivision ? aRaw / bRaw : aRaw * bRaw;
      let displayA = isScientific ? aRaw.toExponential(2).replace('e', 'x10^') : aRaw.toFixed(3);
      let displayB = isScientific ? bRaw.toExponential(2).replace('e', 'x10^') : bRaw.toFixed(3);
      answer = Number(answer.toPrecision(3));
      const questionText = `${displayA} ${isDivision ? '/' : '*'} ${displayB} = ?`;
      return { questionText, correctAnswer: answer };
    }

    let attempt = 0;
    let currentCorrectAnswer = null;

    function generateQuestion() {
      stopTimer();
      startTimer();
      attempt = 0;
      const { questionText, correctAnswer } = getRandomQuestion();
      currentCorrectAnswer = correctAnswer;
      document.getElementById('question').innerText = questionText;
      document.getElementById('feedback').innerText = '';
      document.getElementById('joke').innerText = '';
      document.getElementById('tip').innerText = '';

      const answersDiv = document.getElementById('answers');
      answersDiv.innerHTML = '';
      const choices = [correctAnswer];

      while (choices.length < 4) {
        let delta = Math.max(0.3, Math.abs(correctAnswer) * (Math.random() * 0.5 + 0.5));
        let wrongAnswer = Math.random() < 0.5 ? correctAnswer + delta : correctAnswer - delta;
        wrongAnswer = Number(wrongAnswer.toPrecision(3));
        if (!choices.includes(wrongAnswer)) choices.push(wrongAnswer);
      }

      choices.sort(() => Math.random() - 0.5);
      choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.innerText = choice;
        btn.onclick = () => checkAnswer(choice);
        answersDiv.appendChild(btn);
      });
    }

    function checkAnswer(selected) {
      if (attempt >= 2) return;
      attempt++;
      if (selected === currentCorrectAnswer) {
        stopTimer();
        totalCorrect++;
        currentStreak++;
        totalAnswered++;
        document.getElementById('feedback').innerText = '‚úÖ Correct!';
        document.getElementById('joke').innerText = `üòÇ Joke: ${jokes[Math.floor(Math.random() * jokes.length)]}`;
        document.getElementById('tip').innerText = `üí° Tip: ${tips[Math.floor(Math.random() * tips.length)]}`;
        disableButtons();
      } else {
        if (attempt >= 2) {
          stopTimer();
          totalAnswered++;
          currentStreak = 0;
          document.getElementById('feedback').innerText = `‚ùå Incorrect. Answer: ${currentCorrectAnswer}`;
          disableButtons();
        } else {
          document.getElementById('feedback').innerText = `‚ùå Try again.`;
        }
      }
      localStorage.setItem('streak', currentStreak);
      localStorage.setItem('correct', totalCorrect);
      localStorage.setItem('answered', totalAnswered);
      updateStats();
    }

    function disableButtons() {
      const btns = document.querySelectorAll('#answers button');
      btns.forEach(b => b.disabled = true);
    }

    document.getElementById('difficulty').value = difficulty;
    updateStats();
    generateQuestion();
  </script>
</body>
</html>
